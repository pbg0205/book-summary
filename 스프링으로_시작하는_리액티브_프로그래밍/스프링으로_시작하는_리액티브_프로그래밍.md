# 스프링으로 시작하는 리액티브 프로그래밍

- URL : https://product.kyobobook.co.kr/detail/S000201399476

## chapter01. 리액티브 시스템과 리액티브 프로그래밍

### 리액티브 시스템

1. 리액티브 시스템
   - 사전적 의미 : 어떤 이벤트나 상황이 발생했을 때, 반응을 해서 그에 따라 적절하게 행동하는 것
   - 장점 : 클라이언트 요청에 <u>즉각적으로 응답함으로써 지연 시간을 최소화</u>한다.

### 리액티브 선언문 (설계 원칙)

<img src="images/reactive_declaration.png" width="500">

> 빠른 응답성을 바탕으로 유지보수와 확장이 용이한 시스템 구축에 도움이 된다.

- MEANS : reactive system 주요 통신 수단으로 무엇을 사용할 것인지 표현
  - 비동기 메시지 기반의 통신을 통해 느슨한 결합, 격리성, 위치 투명성 보장
- FORM : 비동기 메시지 통신을 통해 어떠한 형태를 지니는 시스템으로 형성되는지에 관한 내용
  - 탄력성(elastic) : 시스템 작업량이 변화하더라도 일정한 응답을 유지한다.
  - 회복성(resilient) : 시스템 장애 발생 시 응답성을 유지하는 것을 의미
- VALUE : 회복성과 탄력성을 기반으로 즉각적 응답 가능한 시스템 구축이 가능하다.

### 리액티브 프로그래밍

- Non-blocking 방식의 통신
  - Blocking : 해당 스레드의 작업이 처리될 때까지 남아있는 작업들이 대기하는 방식 (스레드 차단)
  - Non-blocking : 해당 작업 처리를 대기하지 않고 남아있는 작업을 처리하는 방식

### 리액티브 프로그래밍 특징

1. declarative programming
    - 선언적 : 실행할 동작을 구체적으로 명시하지 않고 목표만 선언하는 방식
    - 명령형 : 실행할 동작을 구체적으로 명시하는 방식
2. data stream & the propagation of change
    - data stream : 데이터가 지속적으로 발생한다는 의미
    - the propagation of change : 지속적으로 데이터가 발생할 때마다 변화하는 이벤트를 보고,
      이 이벤트를 발생시키면서 데이터를 계속적으로 전달하는 것

### 리액티브 프로그래밍 코드 구성

1. publisher : 입력으로 들어오는 데이터를 제공하는 역할
2. subscriber : publisher 로부터 전달받은 데이터를 사용하는 역할
3. data source : publisher 의 입력으로 들어오는 데이터를 대표하는 용어 (reactive programming 에서는 data stream)
4. operator : publisher 와 subscriber 중간에서 가공 처리가 이루어지는 영역

<br>

## chapter02. 리액티브 스트림즈

### 리액티브 스트림즈

- 데이터 스트림을 non-blocking 이면서 비동기적인 방식으로 처리하기 위한 리액티브 라이브러리 표준 사양

### 리액티브 스트림즈 구성요소

| 컴포넌트         | 설명                                                                                                                       |
|--------------|--------------------------------------------------------------------------------------------------------------------------|
| Publisher    | 데이터 생성, 발생하는 역할                                                                                                          |
| Subscriber   | 구독한 publisher 로 부터 데이터를 전달받아 처리하는 역할                                                                                     |
| Subscription | Publisher 에 요청할 데이터 개수를 지정하고, 데이터 구독을 취소하는 역할                                                                            |
| Processor | Publisher & Subscriber 의 기능을 모두 가지고 있다. 즉, Subscriber 로서 다른 Publisher 를 구독할 수 있고, Publisher 로서 다른 Subscriber 가 구독할 수 있다. |

<img src="images/pubsub_동작과정.png" width="800">

### Publisher

```java
public interface Publisher<T> {
	public void subscribe(Subscriber<? super T> s);
}
```
- subscribe : 전달받은 Subscriber 를 등록하는 역할을 한다.
  (Pubsub 은 메시지 데이터 전송만 하면 되기 떄문에 loose coupled structure 라 볼 수 있다.)

### Subscriber

```java

public interface Subscriber<T> {
	public void onSubscribe(Subscription s);
	public void onNext(T t);
	public void onError(Throwable t);
	public void onComplete();
}
```
- onSubscribe : 구독 시작 시점에 어떤 처리를 하는 역할
- onNext : Publisher 가 데이터 통지를 위한 처리하는 역할
- onError : Publisher 가 데이터 통지를 위한 처리 과정에서 에러가 발생했을 때 해당 에러를 처리하는 역할
- onComplete : Publisher 가 데이터 통지를 완료했음을 알릴 때 호출되는 메서드

### Subscription

```java
public interface Subscription {
	public void request(long n);
	public void cancel();
}
```

- request : Publisher 에게 요청할 데이터 갯수
- cancel : 구독을 취소할 수 있음


### 동작 과정

1. Publisher 내부 에서 Subscriber onSubscribe() 메서드 호출 -> Subscriber 에게 Subscription 을 전달 
2. Subscriber onSubscription() 메서드에서 전달받은 Publisher 에게 Subscription 객체를 통해 전달받을 데이터 갯수 요청
3. Publisher 는 Subscriber onNext() 를 통해 Subscriber 에게 전달
4. Publisher 의 발행할 데이터가 없으면 onComplete() 호출 -> Subscriber 에게 데이터 처리 종료를 알림

### Processor

```java
public interface Processor<T, R> extends Subscriber<T>, Publisher<T> {
}
```
- Publisher, Subscriber 를 모두 상속하고 있음
- Publisher & Subscriber 의 기능을 모두 가지고 있음

### 리액티브 스트림즈 관련 용어 정의

- Signal : Publisher & Subscriber 가넹 주고 받는 상호 작용
  - onSubscriber(), onNest(), onCompmlete(), onError(), request(), cancel()
- Demand : Publisher 가 Subscriber 에게 아직 전달하지 않은 요청 데이터
- Emit : 데이터를 내보내는 과정
  - 데이터를 전달하기 위한 onNext Signal -> 데이터를 emit 한다.
- upstream, downstream : 코드 라인 기준 상위, 하위에 존재하는 스트림
- sequence : Publisher 가 emit 하는 데이터의 연속적인 흐름을 정의해 놓은 자체
- Operator : 연산자 (reactive programming 핵심)
- Source : '최초의' 의미 (Original 용어도 사용)

